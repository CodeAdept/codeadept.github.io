((3) 0 () 7 ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-17-thanks-zed.md" . unix) (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-16-analyze-dependencies.md" . unix) (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-14-groovy-grails-ria.md" . unix) (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-14-maven-multi-module-quickstart.md" . unix) (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-16-continuous-integration-with-flex.md" . unix) (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-21-grails-goodness.md" . unix) (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-25-unit-testing-jsp-custom-tags.md" . unix)) () (h ! (equal) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-16-analyze-dependencies.md" . unix) f post (u . "Analyzing Dependencies With The Maven Site Plugin") (? . 1) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/16/analyzing-dependencies-with-the-maven-site-plugin/index.html" . unix) "/blog/2008/01/16/analyzing-dependencies-with-the-maven-site-plugin/" (u . "2008-01-16T00:00:01") (? . 4) (? . 0) (c (u . "java") c (u . "maven")) (u . "\n<p>Now as most people will tell you I’m kind of a geek when it comes to Maven. It’s really a nice tool and it makes dependency management in large projects almost a no brainer…almost. The story I’m about to share is true, only the names have been changed to protect the innocent…</p>") #t (u . "\n<p>Now as most people will tell you I’m kind of a geek when it comes to Maven. It’s really a nice tool and it makes dependency management in large projects almost a no brainer…almost. The story I’m about to share is true, only the names have been changed to protect the innocent…</p>\n<!-- more-->\n\n<p>A couple of weeks ago we were having some clashes in one of our applications due to an older version of log4j showing up on the classpath. So what could have been like finding a needle in a haystack was actually fairly simple to track down, if you only know where to look. Thankfully, some of my ranting and raving about Maven has rubbed off at this client. They took some of my suggestions as far as Maven-izing their new projects and have even seen the benefits of using the site plugin to generate project documentation. In this case, the site plugin is what ended up saving us. In the site documentation that is generated there are a couple of reports called, oddly enough, <code>Dependencies</code> and <code>Dependency Convergence</code>.</p>\n\n<h2 id=\"dependency-convergence\">Dependency Convergence</h2>\n\n<p>The Dependency Convergence report is especially nice when dealing with large multi-module projects. At this client it is normal for each project to contain anywhere from 3 – 7 modules and maintaining a pom.xml for each one can sometimes lead to versions getting out of sync between modules. This report analyzes all of the dependency versions that appear in all of the modules for the project, and compares them to the versions of the dependencies defined for this particular module.</p>\n\n<p>At the top of the report you’ll see the summary. In this specific report you’ll see that this module has quite a few mismatched versions being defined as dependencies.</p>\n\n<div class=\"figure\"><img src=\"/img/dependency-stats1.png\" alt=\"Dependency Convergence Summary\" />\n <p class=\"caption\">Dependency Convergence Summary</p></div>\n\n<p>The rest of the report consists of an itemized list of every dependency that is defined in the module and this is where you can see what the discrepancies are, if any.</p>\n\n<div class=\"figure\"><img src=\"/img/dependency-convergence.png\" alt=\"Dependency Convergence\" />\n <p class=\"caption\">Dependency Convergence</p></div>\n\n<h2 id=\"dependencies\">Dependencies</h2>\n\n<p>The Dependencies report is the one that actually saved us some serious investigation. We had just gone through and removed any explicit dependencies on log4j, since we were using commons-logging and Weblogic provides log4j for us. Somehow log4j kept showing up on the classpath, and it was an older version which had a method with a different signature than what was provided by Weblogic, so it was still causing problems. So along comes the dependency report to the rescue. The top of the report lists out what dependencies are defined and in what scope, followed by any transitive dependencies. A little further down the report is a section that actually gives a tree-view of your dependencies so you can see the hierarchy. Here is where we discovered that displaytag was the culprit.</p>\n\n<div class=\"figure\"><img src=\"/img/dependency-hierarchy.png\" alt=\"Dependency Tree\" />\n <p class=\"caption\">Dependency Tree</p></div>")) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-17-thanks-zed.md" . unix) f post (u . "Thanks Zed...Long Live Grails") (? . 0) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/17/thanks-zed-long-live-grails/index.html" . unix) "/blog/2008/01/17/thanks-zed-long-live-grails/" (u . "2008-01-17T00:00:00") (? . 1) (? . 5) (c (u . "grails") c (u . "java") c (u . "rails") c (u . "rant")) (u . "\n<p>I ran across this post on Rick Hightower’s blog the other day titled <a href=\"http://www.jroller.com/RickHigh/entry/thanks_zed_btw_syntax_matters\">Thanks Zed</a>. I have to agree with Rick on many points, especially that Java should stop wasting it’s time with supporting JRuby and instead focus those efforts on Groovy and Grails. Like Rick, I had bought several Rails books and after it was all said and done, I wasn’t really that impressed. I am a huge fan of the whole “Convention Over Configuration” paradigm, but I guess I just wasn’t ready to give up on Java just yet and jump on the Rails bandwagon.</p>") #f (u . "\n<p>I ran across this post on Rick Hightower’s blog the other day titled <a href=\"http://www.jroller.com/RickHigh/entry/thanks_zed_btw_syntax_matters\">Thanks Zed</a>. I have to agree with Rick on many points, especially that Java should stop wasting it’s time with supporting JRuby and instead focus those efforts on Groovy and Grails. Like Rick, I had bought several Rails books and after it was all said and done, I wasn’t really that impressed. I am a huge fan of the whole “Convention Over Configuration” paradigm, but I guess I just wasn’t ready to give up on Java just yet and jump on the Rails bandwagon.</p>")) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-14-maven-multi-module-quickstart.md" . unix) f post (u . "Maven Multi-Module Quickstart") (? . 3) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/14/maven-multi-module-quickstart/index.html" . unix) "/blog/2008/01/14/maven-multi-module-quickstart/" (u . "2008-01-14T00:00:00") #f (? . 2) (c (u . "java") c (u . "maven")) (u . "\n<p>Recently I&rsquo;ve had lots of questions about how to create multi-module projects, so when I discovered this technique, I thought I&rsquo;d write this up. This technique exploits a little known feature of the <code>archetype:create</code> plugin, and the Maven site archetype to kickstart your project. Creating a multi-module project has many benefits, one of them being the ability to build every artifact in a project with one simple <code>mvn compile</code> command. Another benefit is that if you are using either the maven <code>eclipse:eclipse</code> plugin or the <code>idea:idea</code> plugin, you can enter this command at the root of the project and it will generate all of the project files for all of the contained modules.</p>") #t (u . "\n<p>Recently I&rsquo;ve had lots of questions about how to create multi-module projects, so when I discovered this technique, I thought I&rsquo;d write this up. This technique exploits a little known feature of the <code>archetype:create</code> plugin, and the Maven site archetype to kickstart your project. Creating a multi-module project has many benefits, one of them being the ability to build every artifact in a project with one simple <code>mvn compile</code> command. Another benefit is that if you are using either the maven <code>eclipse:eclipse</code> plugin or the <code>idea:idea</code> plugin, you can enter this command at the root of the project and it will generate all of the project files for all of the contained modules.</p>\n<!-- more-->\n\n<p>First generate the top level project using the <code>maven-archetype-site-simple</code> archetype using the following command,</p>\n\n<pre><code>mvn archetype:create\n -DgroupId=[Java:the project's group id]\n -DartifactId=[Java:the project's artifact id]\n -DarchetypeArtifactId=maven-archetype-site-simple\n</code></pre>\n\n<p>this will generate a Maven project with the following directory structure.</p>\n\n<div class=\"figure\"><img src=\"/img/maven-archetype-site-simple.png\" alt=\"Maven Site Simple Folder\" title=\"folder structure\" />\n <p class=\"caption\">Maven Site Simple Folder</p></div>\n\n<p>The project that is generated is the minimum project setup to generate site documentation. The <code>index.apt</code> file is the main index page for the site, and is written in the Almost Plain Text format, which is a wiki like format. You can also generate a more complete site project using the <code>maven-archetype-site</code> archetype like this,</p>\n\n<pre><code>mvn archetype:create\n -DgroupId=[Java:the project's group id]\n -DartifactId=[Java:the project's artifact id]\n -DarchetypeArtifactId=maven-archetype-site</code></pre>\n\n<p>This will generate the following project structure.</p>\n\n<div class=\"figure\"><img src=\"/img/maven-archetype-site.png\" alt=\"Maven Site Folder Structure\" title=\"site folder structure\" />\n <p class=\"caption\">Maven Site Folder Structure</p></div>\n\n<p>After you have generated the site project, edit the <code>pom.xml</code> created from the site archetype plugin. Make sure the the packaging type is set to <code>pom</code> like the following.</p>\n\n<div class=\"brush: xml\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre>1\n2\n3\n4\n5\n6\n7\n8</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"nt\">&lt;project&gt;</span>\n    <span class=\"nt\">&lt;modelversion&gt;</span>4.0.0<span class=\"nt\">&lt;/modelversion&gt;</span>\n    <span class=\"nt\">&lt;groupid&gt;</span>com.pillartechnology<span class=\"nt\">&lt;/groupid&gt;</span>\n    <span class=\"nt\">&lt;artifactid&gt;</span>sampleProject<span class=\"nt\">&lt;/artifactid&gt;</span>\n    <span class=\"nt\">&lt;version&gt;</span>1.0-SNAPSHOT<span class=\"nt\">&lt;/version&gt;</span>\n<span class=\"nt\">&lt;packaging&gt;</span>pom<span class=\"nt\">&lt;/packaging&gt;</span>\n...\n<span class=\"nt\">&lt;/project&gt;</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>By setting the packaging type to <code>pom</code>, any projects you generate from the root of the project directory will insert itself into the project by creating an entry into the modules section of the <code>pom.xml</code> for the site. In the root directory of your project that you created above, type in the following command,</p>\n\n<pre><code>mvn archetype:create\n -DgroupId=[Java:the module's group id]\n -DartifactId=[Java:the module's artifact id]</code></pre>\n\n<p>If you now edit the <code>pom.xml</code> for the main project, you should see an entry towards the bottom of the file like the following.</p>\n\n<div class=\"brush: xml\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre>1\n2\n3\n4\n5</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span>...\n<span class=\"nt\">&lt;modules&gt;</span>\n    <span class=\"nt\">&lt;module&gt;</span>sampleModule<span class=\"nt\">&lt;/module&gt;</span>\n<span class=\"nt\">&lt;/modules&gt;</span>\n...\n</pre></div>\n</td></tr></tbody></table>\n</div>")) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-14-groovy-grails-ria.md" . unix) f post (u . "Groovy, Grails, and RIAs...Oh My!") (? . 2) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/14/groovy-grails-and-rias-oh-my/index.html" . unix) "/blog/2008/01/14/groovy-grails-and-rias-oh-my/" (u . "2008-01-14T00:01:00") (? . 3) (? . 4) (c (u . "codemash") c (u . "grails") c (u . "groovy") c (u . "ria")) (u . "\n<p>This past week I was fortunate enough to attend CodeMash v2.0.0.8 in Sandusky, Ohio. This conference is unlike anything I’ve ever been to, somewhere in the neighborhood of 350 Java programmers, .NET fan-boys and Ruby zealots all under one roof, and even having a little fun together.</p>") #t (u . "\n<p>This past week I was fortunate enough to attend CodeMash v2.0.0.8 in Sandusky, Ohio. This conference is unlike anything I’ve ever been to, somewhere in the neighborhood of 350 Java programmers, .NET fan-boys and Ruby zealots all under one roof, and even having a little fun together.</p>\n<!-- more-->\n\n<p>I started out the day on Thursday with a helping of Groovy. Andrew Glover, one of the co-authors of <em>Groovy in Action</em> talked about Groovy and reignited my passion for this wonderful scripting language. For those of you who haven’t looked at Groovy yet, you owe it to yourself to take a look at it. Groovy is a “Java”-like scripting language that has some similarities with other dynamic languages like Python and Ruby. Groovy is a dynamically typed language, unlike its Java counterpart, has no checked exceptions, and also has support for things such as closures. The really powerful thing about Groovy is its ability to run in the same JVM as your current Java applications, have access to all of the classes available to Java, and all of your Java applications can also access any libraries you have written in Groovy. This makes for a very easy adoption and integration into existing Java applications, or even quick prototyping that could eventually (if necessary) be replaced by Java code. Don’t be surprised if you see more and more Groovy seeping into Java applications with its low cost of adoption.</p>\n\n<p>The other real exciting session that I attended on Thursday was the Grails presentation given by Chris Judd, who is co-authoring a book called Practical Grails Applications. I was excited to see this framework actually approaching its 1.0 version in the very near future. I had looked at it earlier last year, but it was undergoing such rapid changes to its API that the book I purchased was rendered obsolete by the time I read it. Hopefully Chris and company have a very successful title and I’ll be able to actually build a working application. Grails is rather interesting in that it is similar to Rails in the fact that it follows the “Convention over configuration” theme, but after that most similarities stop. Grails leverages the Groovy language as its main development language, and leverages popular Java frameworks such as Spring and Hibernate to much of the heavy lifting. Even though the main contributor to Grails is a staunch anti-Maven guy (http://graemerocher.blogspot.com/2006/09/vote-to-stop-maven-infesting-spring.html), I’m still pretty excited about this framework and can’t wait to see it grow and prosper in the next year.</p>\n\n<p>Friday I got to hear James Ward, a Flex evangelist from Adobe, give a presentation on migrating Web 1.0 applications to RIAs. As some of you may know BJ Allmon and I are writing a book on Flex and how to do Agile programming using Flex. This presentation was especially helpful in the fact that James pretty much validated the whole book for us in this one presentation. His set of steps for refactoring Web 1.0 applications to Flex practically mirrored our table of contents that I had written just a couple of weeks before attending this conference.</p>\n\n<p>I had a wonderful time at this conference. I finally got to meet Bruce, who was the one who recruited me to Pillar, and BJ who will be helping me write possibly the best Flex book ever. I also got to meet some other very bright people out there in the technology world and pick their brains about some of the bleeding edge topics that interest me. I really hope that Pillar keeps sponsoring this conference and sends more and more of us each year to experience this.</p>")) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-16-continuous-integration-with-flex.md" . unix) f post (u . "Continuous Integration With Flex") (? . 4) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/16/continuous-integration-with-flex/index.html" . unix) "/blog/2008/01/16/continuous-integration-with-flex/" (u . "2008-01-16T00:00:00") (? . 2) (? . 1) (c (u . "agile") c (u . "ci") c (u . "flex") c (u . "flexunit") c (u . "java") c (u . "tdd") c (u . "ria")) (u . "\n<p>Earlier today I had posed a question to a mailing list in the .NET community asking about Continuous Integration with Flex in the .NET world. After a couple of answers from people who obviously did not understand the question, because they just told me to google CruiseControl.NET, someone with some knowledge of TDD and Agile practices stepped up and pointed out the obvious point I was trying to make. <strong>There currently is no real good way to automate your FlexUnit tests in such a way that a CI server like CC.NET or HudsonCI would know whether or not all of the tests for your Actionscript classes passed or failed.</strong></p>") #t (u . "\n<p>Earlier today I had posed a question to a mailing list in the .NET community asking about Continuous Integration with Flex in the .NET world. After a couple of answers from people who obviously did not understand the question, because they just told me to google CruiseControl.NET, someone with some knowledge of TDD and Agile practices stepped up and pointed out the obvious point I was trying to make. <strong>There currently is no real good way to automate your FlexUnit tests in such a way that a CI server like CC.NET or HudsonCI would know whether or not all of the tests for your Actionscript classes passed or failed.</strong></p>\n<!-- more-->\n\n<p>~~So I’ve decided to start a Google Code project called agile-flex, where a couple of other developers and I will attempt to build some agile tools for the Flex framework, starting with a test runner that will help enable continuous integration for Java, .NET, or even just plain old Actionscript. The runner will likely be based off an article I found from Aaron Spjut here. In a nutshell we will create a test runner in Adobe AIR that will generate XML output similar to JUnit and NUnit for the CI server to be able to interpret. This will also enable the generation of report artifacts using the JUnit Report tasks or even a custom XSLT if desired. I’ll post more details as the project continues.~~</p>\n\n<p>UPDATE… The Flex-Mojos project now fulfills this need, so I’ve deleted the Google Code Project that we started for this.</p>")) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-21-grails-goodness.md" . unix) f post (u . "Grails Goodness") (? . 5) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/21/grails-goodness/index.html" . unix) "/blog/2008/01/21/grails-goodness/" (u . "2008-01-21T00:00:00") (? . 0) (? . 6) (c (u . "grails") c (u . "groovy") c (u . "java")) (u . "\n<p>I’m a huge fan of Grails, and after hearing a couple of talks on it at CodeMash last week I decided to check in on it’s progress. I had first caught wind of Grails last winter when I purchased the book <a href=\"http://www.apress.com/book/view/1590597583\">The Definitive Guide to Grails</a>. I had been attempting to learn Ruby on Rails, and was quite unimpressed. I’m a big fan of the whole “Convention over configuration” way of thinking, but for some reason Rails just never did it for me. Unfortunately the Grails project was undergoing so many API changes as it was working towards the 1.0 release, that it basically rendered the sample application in the book unusable. Through much digging through the documentation and the APIs I was able to struggle through most of the book and knew that this framework had great potential. So now Grails is approaching 1.0 very soon and it’s time to re-familiarize myself with this wonderful platform.</p>") #t (u . "\n<p>I’m a huge fan of Grails, and after hearing a couple of talks on it at CodeMash last week I decided to check in on it’s progress. I had first caught wind of Grails last winter when I purchased the book <a href=\"http://www.apress.com/book/view/1590597583\">The Definitive Guide to Grails</a>. I had been attempting to learn Ruby on Rails, and was quite unimpressed. I’m a big fan of the whole “Convention over configuration” way of thinking, but for some reason Rails just never did it for me. Unfortunately the Grails project was undergoing so many API changes as it was working towards the 1.0 release, that it basically rendered the sample application in the book unusable. Through much digging through the documentation and the APIs I was able to struggle through most of the book and knew that this framework had great potential. So now Grails is approaching 1.0 very soon and it’s time to re-familiarize myself with this wonderful platform.</p>\n<!-- more-->\n\n<p>Earlier this week I discovered a new article on IBM’s DeveloperWorks site titled <a href=\"http://www.ibm.com/developerworks/java/library/j-grails01158/index.html?S_TACT=105AGX45&amp;S_CMP=LPJAVA\">Mastering Grails: Build your first Grails Application</a> by Scott Davis. This article is very much a basic introduction to Grails. It takes the reader through creating the application and generating a simple domain class and controller. I love how in less than 100 lines of code, we’re able to have a complete CRUD application. If you use scaffolding, you can do it in just 15. Just a taste, definitely leaving the reader wanting more. Hopefully the next article will go in depth much more. Thankfully the code actually works as is and I didn’t have to do any digging to find out how to make it work. Until Chris Judd and company finish their Grails book Practical Grails Projects, I guess I’m stuck wading through the tutorials that may or may not work anymore depending on how long ago they were written.</p>")) ((p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/_src/posts/2008-01-25-unit-testing-jsp-custom-tags.md" . unix) f post (u . "Unit Testing JSP Custom Tags") (? . 6) 1455915002 (p+ #"/Users/jeremy/Projects/blog/punkisdead.github.io/blog/2008/01/25/unit-testing-jsp-custom-tags/index.html" . unix) "/blog/2008/01/25/unit-testing-jsp-custom-tags/" (u . "2008-01-25T00:00:00") (? . 5) #f (c (u . "java") c (u . "jsp") c (u . "tdd") c (u . "spring")) (u . "\n<p>Testing J2EE components has always been a difficult task, which is probably why I see so many web projects that have few tests written for the web layer or sometimes none at all. Late last year Spring announced the release of Spring 2.5 , with some nice additions to the suite of mock testing objects for unit testing web components. That’s right unit testing web components, not in container testing. So like any good agile programmer let’s start with the test first.</p>") #t (u . "\n<p>Testing J2EE components has always been a difficult task, which is probably why I see so many web projects that have few tests written for the web layer or sometimes none at all. Late last year Spring announced the release of Spring 2.5 , with some nice additions to the suite of mock testing objects for unit testing web components. That’s right unit testing web components, not in container testing. So like any good agile programmer let’s start with the test first.</p>\n<!-- more-->\n\n<div class=\"brush: java\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SomeCustomTagTest</span> <span class=\"kd\">extends</span> <span class=\"n\">TestCase</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">SomeServiceInterface</span> <span class=\"n\">mockService</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">SomeCustomTag</span> <span class=\"n\">someCustomTag</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">MockServletContext</span> <span class=\"n\">mockServletContext</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">MockPageContext</span> <span class=\"n\">mockPageContext</span><span class=\"o\">;</span>\n    <span class=\"kd\">private</span> <span class=\"n\">WebApplicationContext</span> <span class=\"n\">mockWebApplicationContext</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">void</span> <span class=\"nf\">setUp</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n        <span class=\"kd\">super</span><span class=\"o\">.</span><span class=\"na\">setUp</span><span class=\"o\">();</span>\n        <span class=\"c1\">// Create the mock servlet context</span>\n        <span class=\"n\">mockServletContext</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MockServletContext</span><span class=\"o\">();</span>\n\n        <span class=\"c1\">// Create the mock Spring Context so that we can mock out the calls to getBean in the custom tag</span>\n        <span class=\"c1\">// Then add the Spring Context to the Servlet Context</span>\n        <span class=\"n\">mockWebApplicationContext</span> <span class=\"o\">=</span> <span class=\"n\">createMock</span><span class=\"o\">(</span><span class=\"n\">WebApplicationContext</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">);</span>\n        <span class=\"n\">mockServletContext</span><span class=\"o\">.</span><span class=\"na\">setAttribute</span><span class=\"o\">(</span><span class=\"n\">WebApplicationContext</span><span class=\"o\">.</span><span class=\"na\">ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span class=\"o\">,</span>\n                                        <span class=\"n\">mockWebApplicationContext</span><span class=\"o\">);</span>\n\n        <span class=\"c1\">// Create the MockPageContext passing in the mock servlet context created above</span>\n        <span class=\"n\">mockPageContext</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">MockPageContext</span><span class=\"o\">(</span><span class=\"n\">mockServletContext</span><span class=\"o\">);</span>\n\n        <span class=\"c1\">// Create the mock service object using it&#39;s interface</span>\n        <span class=\"n\">mockService</span> <span class=\"o\">=</span> <span class=\"n\">createMock</span><span class=\"o\">(</span><span class=\"n\">SomeServiceInterface</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">);</span>\n\n        <span class=\"c1\">// Create an instance of the custom tag we want to test</span>\n        <span class=\"c1\">// set it&#39;s PageContext to the MockPageContext we created above</span>\n        <span class=\"n\">someCustomTag</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">SomeCustomTag</span><span class=\"o\">();</span>\n        <span class=\"n\">someCustomTag</span><span class=\"o\">.</span><span class=\"na\">setPageContext</span><span class=\"o\">(</span><span class=\"n\">mockPageContext</span><span class=\"o\">);</span>\n\n        <span class=\"c1\">// Whenever you make a call to the doStartTag() method on the custom tag it calls getServletContext()</span>\n        <span class=\"c1\">// on the WebApplicationContext.  So to avoid having to put this expect statement in every test</span>\n        <span class=\"c1\">// I&#39;ve included it in the setUp()</span>\n        <span class=\"n\">expect</span><span class=\"o\">(</span><span class=\"n\">mockWebApplicationContext</span><span class=\"o\">.</span><span class=\"na\">getServletContext</span><span class=\"o\">()).</span><span class=\"na\">andReturn</span><span class=\"o\">(</span><span class=\"n\">mockServletContext</span><span class=\"o\">).</span><span class=\"na\">anyTimes</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>Some things you’ll notice in the setUp() method are that we’re creating a mock for the Spring Context. Since I don’t know of any way to have Spring inject dependencies into the custom tag, we’ll be getting a WebApplicationContext object from the container to get our beans from Spring. This mock allows us to fake calls to getBean() and return our mock service objects so we can unit test the custom tag without relying on external dependencies. Now in order to get this test to compile we need to create the custom tag class. You’ll notice that we’re extending the RequestContextAwareTag class instead of TagSupport. The RequestContextAwareTag class is a Spring helper class that gives us some convenience methods for getting the WebApplicationContext among other things. You’ll also see that the method we need to implement is called doStartTagInternal() instead of doStartTag().</p>\n\n<div class=\"brush: java\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SomeCustomTag</span> <span class=\"kd\">extends</span> <span class=\"n\">RequestContextAwareTag</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"nf\">doStartTagInternal</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n\n        <span class=\"c1\">// put some business logic here</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">SKIP_BODY</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>Now let’s write a failing test. Back in the unit test lets add a test method and a couple of helper methods for the mock objects.</p>\n\n<div class=\"brush: java\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">testDoStartTag</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span><span class=\"o\">{</span>\n    <span class=\"n\">String</span> <span class=\"n\">param</span> <span class=\"o\">=</span> <span class=\"s\">\"Jeremy\"</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span> <span class=\"n\">expectedOutput</span> <span class=\"o\">=</span> <span class=\"s\">\"Hello, \"</span> <span class=\"o\">+</span> <span class=\"n\">param</span><span class=\"o\">;</span>\n\n    <span class=\"n\">replayAllMocks</span><span class=\"o\">();</span>\n\n    <span class=\"n\">someCustomTag</span><span class=\"o\">.</span><span class=\"na\">setUserName</span><span class=\"o\">(</span><span class=\"n\">param</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">tagReturnValue</span> <span class=\"o\">=</span> <span class=\"n\">someCustomTag</span><span class=\"o\">.</span><span class=\"na\">doStartTag</span><span class=\"o\">();</span>\n    <span class=\"n\">String</span> <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"o\">((</span><span class=\"n\">MockHttpServletResponse</span><span class=\"o\">)</span> <span class=\"n\">mockPageContext</span><span class=\"o\">.</span><span class=\"na\">getResponse</span><span class=\"o\">()).</span><span class=\"na\">getContentAsString</span><span class=\"o\">();</span>\n\n    <span class=\"n\">assertEquals</span><span class=\"o\">(</span><span class=\"s\">\"Tag should return &#39;SKIP_BODY&#39;\"</span><span class=\"o\">,</span> <span class=\"n\">TagSupport</span><span class=\"o\">.</span><span class=\"na\">SKIP_BODY</span><span class=\"o\">,</span> <span class=\"n\">tagReturnValue</span><span class=\"o\">);</span>\n    <span class=\"n\">assertEquals</span><span class=\"o\">(</span><span class=\"s\">\"Output should be &#39;Hello, Jeremy&#39;\"</span><span class=\"o\">,</span> <span class=\"n\">expectedOutput</span><span class=\"o\">,</span> <span class=\"n\">output</span><span class=\"o\">);</span>\n\n    <span class=\"n\">verifyAllMocks</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">replayAllMocks</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">replay</span><span class=\"o\">(</span><span class=\"n\">mockWebApplicationContext</span><span class=\"o\">);</span>\n    <span class=\"n\">replay</span><span class=\"o\">(</span><span class=\"n\">mockCompanyQuery</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">verifyAllMocks</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"n\">verify</span><span class=\"o\">(</span><span class=\"n\">mockWebApplicationContext</span><span class=\"o\">);</span>\n    <span class=\"n\">verify</span><span class=\"o\">(</span><span class=\"n\">mockCompanyQuery</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>In order to get the test to compile, you’ll need to modify the SomeCustomTag class to have a setter method for a userName parameter. We would like our custom tag to say “Hello” to a username that is passed in, so let’s implement the behavior we are trying to accomplish.</p>\n\n<div class=\"brush: java\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SomeCustomTag</span> <span class=\"kd\">extends</span> <span class=\"n\">RequestContextAwareTag</span> <span class=\"o\">{</span>\n\n    <span class=\"kd\">private</span> <span class=\"n\">String</span> <span class=\"n\">userName</span><span class=\"o\">;</span>\n\n    <span class=\"c1\">// A setter for an attribute that will be set in the custom tag</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">userName</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">userName</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">userName</span> <span class=\"o\">=</span> <span class=\"n\">userName</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"nf\">doStartTagInternal</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n\n        <span class=\"n\">pageContext</span><span class=\"o\">.</span><span class=\"na\">getOut</span><span class=\"o\">().</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">\"Hello, \"</span> <span class=\"o\">+</span> <span class=\"n\">userName</span><span class=\"o\">);</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">SKIP_BODY</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>Next we would like to get the users full name from our Spring service. So in order to do that we need to tell the mockWebApplicationContext to return a mock of our service so we can unit test this in isolation. We also need to tell our mock service that we expect a call to getFullName() and what to return from this call. So modify our test method to resemble the following.</p>\n\n<div class=\"brush: java\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12\n13\n14\n15\n16\n17\n18</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">testDoStartTag</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span><span class=\"o\">{</span>\n    <span class=\"n\">String</span> <span class=\"n\">param</span> <span class=\"o\">=</span> <span class=\"s\">\"Jeremy\"</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span> <span class=\"n\">fullName</span> <span class=\"o\">=</span> <span class=\"s\">\"Jeremy Anderson\"</span><span class=\"o\">;</span>\n    <span class=\"n\">String</span> <span class=\"n\">expectedOutput</span> <span class=\"o\">=</span> <span class=\"s\">\"Hello, \"</span> <span class=\"o\">+</span> <span class=\"n\">fullName</span><span class=\"o\">;</span>\n\n    <span class=\"n\">expect</span><span class=\"o\">(</span><span class=\"n\">mockWebApplicationContext</span><span class=\"o\">.</span><span class=\"na\">getBean</span><span class=\"o\">(</span><span class=\"s\">\"someService\"</span><span class=\"o\">)).</span><span class=\"na\">andReturn</span><span class=\"o\">(</span><span class=\"n\">mockService</span><span class=\"o\">);</span>\n    <span class=\"n\">expect</span><span class=\"o\">(</span><span class=\"n\">someService</span><span class=\"o\">.</span><span class=\"na\">getFullName</span><span class=\"o\">(</span><span class=\"n\">param</span><span class=\"o\">)).</span><span class=\"na\">andReturn</span><span class=\"o\">(</span><span class=\"n\">fullName</span><span class=\"o\">);</span>\n    <span class=\"n\">replayAllMocks</span><span class=\"o\">();</span>\n\n    <span class=\"n\">someCustomTag</span><span class=\"o\">.</span><span class=\"na\">setUserName</span><span class=\"o\">(</span><span class=\"n\">param</span><span class=\"o\">);</span>\n    <span class=\"kt\">int</span> <span class=\"n\">tagReturnValue</span> <span class=\"o\">=</span> <span class=\"n\">someCustomTag</span><span class=\"o\">.</span><span class=\"na\">doStartTag</span><span class=\"o\">();</span>\n    <span class=\"n\">String</span> <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"o\">((</span><span class=\"n\">MockHttpServletResponse</span><span class=\"o\">)</span> <span class=\"n\">mockPageContext</span><span class=\"o\">.</span><span class=\"na\">getResponse</span><span class=\"o\">()).</span><span class=\"na\">getContentAsString</span><span class=\"o\">();</span>\n\n    <span class=\"n\">assertEquals</span><span class=\"o\">(</span><span class=\"s\">\"Tag should return &#39;SKIP_BODY&#39;\"</span><span class=\"o\">,</span> <span class=\"n\">TagSupport</span><span class=\"o\">.</span><span class=\"na\">SKIP_BODY</span><span class=\"o\">,</span> <span class=\"n\">tagReturnValue</span><span class=\"o\">);</span>\n    <span class=\"n\">assertEquals</span><span class=\"o\">(</span><span class=\"s\">\"Output should be &#39;Hello, Jeremy Anderson&#39;\"</span><span class=\"o\">,</span> <span class=\"n\">expectedOutput</span><span class=\"o\">,</span> <span class=\"n\">output</span><span class=\"o\">);</span>\n\n    <span class=\"n\">verifyAllMocks</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>Now when you run this code, you’ll get an error from EasyMock complaining about methods that were expected to be called, but weren’t. So lets fix that now. Modify the doStartTagInternal() method to look like the following.</p>\n\n<div class=\"brush: java\">\n <table class=\"sourcetable\">\n  <tbody>\n   <tr>\n    <td class=\"linenos\">\n     <div class=\"linenodiv\">\n      <pre> 1\n 2\n 3\n 4\n 5\n 6\n 7\n 8\n 9\n10\n11\n12</pre></div></td>\n    <td class=\"code\">\n     <div class=\"source\">\n      <pre><span></span><span class=\"kd\">protected</span> <span class=\"kt\">int</span> <span class=\"nf\">doStartTagInternal</span><span class=\"o\">()</span> <span class=\"kd\">throws</span> <span class=\"n\">Exception</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// Get the Spring Context from the RequestContext</span>\n    <span class=\"n\">WebApplicationContext</span> <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"n\">getRequestContext</span><span class=\"o\">().</span><span class=\"na\">getWebApplicationContext</span><span class=\"o\">();</span>\n\n    <span class=\"c1\">// Get the service we want to call from the Spring Context</span>\n    <span class=\"n\">someService</span> <span class=\"o\">=</span> <span class=\"o\">(</span><span class=\"n\">SomeServiceInterface</span><span class=\"o\">)</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"na\">getBean</span><span class=\"o\">(</span><span class=\"s\">\"someService\"</span><span class=\"o\">);</span>\n\n    <span class=\"n\">String</span> <span class=\"n\">fullName</span> <span class=\"o\">=</span> <span class=\"n\">someService</span><span class=\"o\">.</span><span class=\"na\">getFullName</span><span class=\"o\">(</span><span class=\"n\">userName</span><span class=\"o\">);</span>\n    <span class=\"n\">pageContext</span><span class=\"o\">.</span><span class=\"na\">getOut</span><span class=\"o\">().</span><span class=\"na\">print</span><span class=\"o\">(</span><span class=\"s\">\"Hello, \"</span> <span class=\"o\">+</span> <span class=\"n\">fullName</span><span class=\"o\">);</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">SKIP_BODY</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n</pre></div>\n</td></tr></tbody></table>\n</div>\n\n<p>Congratulations, you’ve now implemented a JSP Custom Tag using “Test First”.</p>"))))